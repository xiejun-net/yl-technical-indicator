!function(o,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((o="undefined"!=typeof globalThis?globalThis:o||self).ylIndicator={})}(this,function(o){"use strict";function R(o,t){return+t<+o?+o:+t}function f(o,t){return+o<+t?+o:+t}function w(o){return Math.abs(+o)}function m(o,t,e,n){return(e*o+(t-e)*n)/t}o.ARBR=function(l,r=[26]){let u=0,c=0,i=0,s=0;const f=[];let a;const M=o=>Math.max(0,o);return l.forEach((o,t)=>{const e={};var n=o.open,h=o.high,o=o.low;u+=h-n,c+=n-o,e.ar=0===c?0:u/c*100,0<t&&(a=l[t-1].close,i+=M(h-a),s+=M(a-o),0===s?e.br=0:e.br=i/s*100,t>=r[0]-1&&(o=l[t-(r[0]-1)],u-=o.high-o.open,c-=o.open-o.low,t>r[0]-1&&(t=l[t-(r[t=0]-1)-1].close,i-=M(o.high-t),s-=M(t-o.low)))),f.push({AR:e.ar||0,BR:e.br||0})}),f},o.BOLL=function(o,t=[20,2]){for(var e,n,h,l,r,u,c=t[0],i=t[1],s=[],f=0,a=0;a<o.length;a++){if(f+=o[a].close,c-1<=a){for(e=f/c,u=0,l=a-(c-1);l<=a;l++)u+=(r=o[l].close-e)*r;n=e+i*(u=Math.sqrt(u/c)),h=e-i*u,f-=o[a-(c-1)].close}else e=n=h=0;s.push({MID:e,UPPER:n,LOWER:h})}return s},o.CR=function(o,n=[26,6,10,20,60]){let h=[],l=[0,0,0,0];const r=[],u=[];let c=0,i=0,s=[],f=[];const a=[],M={CR:0,MA1:0,MA2:0,MA3:0,MA4:0};let A;return o.forEach((o,t)=>{0===t&&(A=o);var e=(A.high+A.low)/2,t=Math.max(0,o.high-e);s.push(t),c+=t;e=Math.max(0,e-o.low);f.push(e),i+=e,0!==i&&(M.CR=c/i*100),s.length===n[0]&&(c-=s.shift()),f.length===n[0]&&(i-=f.shift()),n.slice(1).forEach((o,t)=>{h[t]=h[t]||0,h[t]+=M.CR,r[t]=r[t]||[],r[t].push(M.CR);var e=Math.floor(o/2.5+1);r[t].length===o&&(u[t]=u[t]||[],u[t].push(h[t]/o),l[t]++,h[t]-=r[t].shift()),l[t]>=e&&(e=l[t]-e-1,M[`MA${t+1}`]=u[t][e]||0)}),A=o,a.push({...M})}),a},o.DMA=function(l,r=[10,50,10]){const u=Math.max(r[0],r[1]);let c=0,i=0,s=0;const f=[];return l.forEach((o,t)=>{const e={DMA:0,AMA:0};o=o.close;c+=o,i+=o;let n,h;t>=r[0]-1&&(n=c/r[0],c-=l[t-(r[0]-1)].close),t>=r[1]-1&&(h=i/r[1],i-=l[t-(r[1]-1)].close),t>=u-1&&(o=n-h,e.DMA=o,s+=o,t>=u+r[2]-2&&(e.AMA=s/r[2],s-=f[t-(r[2]-1)].DMA)),f.push({...e})}),f},o.EMA=function(o,t=[5,10,20]){let e=t,r={};return o.map((n,h)=>{let l={};return e.forEach(o=>{var t,e;0<h?(r[`EMA${o}`]=(t=n.close,e=r[`EMA${o}`],(2*t+(o-1)*(e=e||0))/(o+1)),l[`EMA${o}`]=o<=h?r[`EMA${o}`]:0):(l[`EMA${o}`]=0,r[`EMA${o}`]=0)}),l})},o.EMV=function(h,l=[14,9]){let r=0,u=0,c=0,i=0,s,f,a,M,A;const E=[],p=[],g={EMV:0,EMVA:0};return h.forEach((o,t)=>{var e=o.high,n=o.low;c+=e-n,i+=o.volume,t>=l[0]-1&&A&&(s=0===o.volume?0:i/l[0]/o.volume,f=(e+n-(A.high+A.low))/(e+n)*100,a=0===c?0:f*s*(e-n)/(c/l[0]),E.push(a),r+=a,M=h[t-(l[0]-1)],i-=M.volume,c-=M.high-M.low,t>=2*l[0]-2&&(g.EMV=r/l[0],r-=E.shift(),u+=g.EMV,t>=2*l[0]+l[1]-3&&(g.EMVA=u/l[1],u-=p[t-(l[1]-1)].EMV))),A=o,p.push({...g})}),p},o.KDJ=function(o,t=[9,3,3]){var e,n=t[0],h=t[1],l=t[2];let r=1/0,u=-1/0,c,i=0,s=0,f,a,M=[];for(f=0;f<o.length;f++){for(e=o[f].close,r=1/0,u=-1/0,a=f<n?0:f-n+1;a<=f;a++)r>o[a].low&&(r=o[a].low),u<o[a].high&&(u=o[a].high);c=(e-r)/(u-r)*100,!isNaN(c)&&c!==-1/0&&c!==1/0||(c=0),s=f<n?(i=(c+i*f)/(f+1),(i+s*f)/(f+1)):(i=(c+(h-1)*i)/h,(i+(l-1)*s)/l),e=3*i-2*s,M.push({K:i,D:s,J:e})}return M},o.MA=function(l,o=[5,10,20,60,120]){let t=o;const r=[];return l.map((e,n)=>{let h={};return t.forEach((o,t)=>{r[t]=r[t]||{P:0},r[t].P+=e.close,o-1<=n?(h[`MA${o}`]=r[t].P/o,r[t].P-=l[n-(o-1)].close):h[`MA${o}`]=0}),h})},o.MACD=function(o,e=[12,26,9]){let n,h,l=0,r=0,u,c=0,i;const s=[];return o.forEach((o,t)=>{o=o.close;h=0===t?n=o:(n=(2*o+(e[0]-1)*l)/(e[0]+1),(2*o+(e[1]-1)*r)/(e[1]+1));o=n-h;u=(2*o+c*(e[2]-1))/(e[2]+1),i=2*(o-u),l=n,r=h,c=u,s.push({DIFF:o,DEA:u,MACD:i})}),s},o.MAVOL=function(l,t=[1,5,10,20]){const e=[];return l.forEach((o,n)=>{const h={};t.forEach(t=>{let e=0;if(t-1<=n)for(let o=t;0<o;o--)e+=l[n-o+1].volume;h["VOL"+t]=e/(1e4*t)}),e.push({...h})}),e},o.RSI=function(o,t=[6,12,24]){let e=t[0],n=t[1],h=t[2],l,r,u,c,i,s,f,a,M,A,E,p,g=[];for(p=0;p<o.length;p++)l=o[p].close,0==p?(r=l,c=f=A=0,i=a=E=0):(r=o[p-1].close,c=m(R(l-r,0),e,1,c),i=m(w(l-r),e,1,i),f=m(R(l-r,0),n,1,f),a=m(w(l-r),n,1,a),A=m(R(l-r,0),h,1,A),E=m(w(l-r),h,1,E)),u=c/i*100||0,s=f/a*100||0,M=A/E*100||0,g.push({["RSI"+e]:u,["RSI"+n]:s,["RSI"+h]:M,A:20,D:80});return g},o.SAR=function(o,t=[4,2,20]){let e=t,n,h=null,l,r,u,c=FLAGE.LONG,i=e[1]/100,s;return o.map((o,t)=>(0===t?(l=o.low,r=o.high,s=0):t<e[0]-1?(l=f(l,o.low),s=0):t===e[0]-1&&(l=f(l,o.low),s=l),t>=e[0]&&(n=r,l=c===FLAGE.LONG?o.low<u?(c=FLAGE.SHORT,r=o.low,i=e[1]/100,l=R(o.high,h.high),R(l,n+i*(r-n))):(c=FLAGE.LONG,o.high>n&&(r=o.high,i=f(i+e[1]/100,e[2]/100)),l=f(o.low,h.low),f(l,u+i*(r-u))):o.high>u?(c=FLAGE.LONG,r=o.high,i=e[1]/100,l=f(o.low,h.low),f(l,u+i*(r-n))):(c=FLAGE.SHORT,o.low<n&&(r=o.low,i=f(i+e[1]/100,e[2]/100)),l=R(o.high,h.high),R(l,u+i*(r-u))),s=l),h=o,u=l,{BB:s}))},o.WR=function(r,t,u){return void 0===u&&(u=[{key:"WR1",title:"WR1",type:"line"},{key:"WR2",title:"WR2",type:"line"}]),r.map(function(o,n){var h={WR1:0,WR2:0},l=o.close;return t.forEach(function(o,t){var e=o-1;e<=n&&(o=(e=(o=function(o){void 0===o&&(o=[]);var t=Number.MIN_SAFE_INTEGER,e=Number.MAX_SAFE_INTEGER;return o.forEach(function(o){t=Math.max(o.high,t),e=Math.min(o.low,e)}),{hn:t,ln:e}}(r.slice(n-e,n+1))).hn)-o.ln,h[u[t].key]=0==o?0:(e-l)/o*100)}),h})},Object.defineProperty(o,"__esModule",{value:!0})});
