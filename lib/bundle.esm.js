function BOLL(o,t=[20,2]){for(var n,e,h,l,r,M,c=t[0],A=t[1],u=[],i=0,s=0;s<o.length;s++){if(i+=o[s].close,c-1<=s){for(n=i/c,M=0,l=s-(c-1);l<=s;l++)M+=(r=o[l].close-n)*r;e=n+A*(M=Math.sqrt(M/c)),h=n-A*M,i-=o[s-(c-1)].close}else n=e=h=0;u.push({MID:n,UPPER:e,LOWER:h})}return u}const EMA$1=function(o,t,n){return(2*o+(n-1)*(t=t||0))/(n+1)},MAX=function(o,t){return+t<+o?+o:+t},MIN=function(o,t){return+o<+t?+o:+t},ABS=function(o){return Math.abs(+o)},SMA=function(o,t,n,e){return(n*o+(t-n)*e)/t};function calcHnLn(o){void 0===o&&(o=[]);var t=Number.MIN_SAFE_INTEGER,n=Number.MAX_SAFE_INTEGER;return o.forEach(function(o){t=Math.max(o.high,t),n=Math.min(o.low,n)}),{hn:t,ln:n}}function EMA(o,t=[5,10,20]){let h=t,l={};return o.map((t,n)=>{let e={};return h.forEach(o=>{0<n?(l[`EMA${o}`]=EMA$1(t.close,l[`EMA${o}`],o),e[`EMA${o}`]=o<=n?l[`EMA${o}`]:0):(e[`EMA${o}`]=0,l[`EMA${o}`]=0)}),e})}function MA(l,o=[5,10,20,60,120]){let t=o;const r=[];return l.map((n,e)=>{let h={};return t.forEach((o,t)=>{r[t]=r[t]||{P:0},r[t].P+=n.close,o-1<=e?(h[`MA${o}`]=r[t].P/o,r[t].P-=l[e-(o-1)].close):h[`MA${o}`]=0}),h})}const FLAGE={SHORT:1,LONG:0};function SAR(o,t=[4,2,20]){let n=t,e,h=null,l,r,M,c=FLAGE.LONG,A=n[1]/100,u;return o.map((o,t)=>(0===t?(l=o.low,r=o.high,u=0):t<n[0]-1?(l=MIN(l,o.low),u=0):t===n[0]-1&&(l=MIN(l,o.low),u=l),t>=n[0]&&(e=r,l=c===FLAGE.LONG?o.low<M?(c=FLAGE.SHORT,r=o.low,A=n[1]/100,l=MAX(o.high,h.high),MAX(l,e+A*(r-e))):(c=FLAGE.LONG,o.high>e&&(r=o.high,A=MIN(A+n[1]/100,n[2]/100)),l=MIN(o.low,h.low),MIN(l,M+A*(r-M))):o.high>M?(c=FLAGE.LONG,r=o.high,A=n[1]/100,l=MIN(o.low,h.low),MIN(l,M+A*(r-e))):(c=FLAGE.SHORT,o.low<e&&(r=o.low,A=MIN(A+n[1]/100,n[2]/100)),l=MAX(o.high,h.high),MAX(l,M+A*(r-M))),u=l),h=o,M=l,{BB:u}))}function ARBR(l,r=[26]){let M=0,c=0,A=0,u=0;const i=[];let s;const f=o=>Math.max(0,o);return l.forEach((o,t)=>{const n={};var e=o.open,h=o.high,o=o.low;M+=h-e,c+=e-o,n.ar=0===c?0:M/c*100,0<t&&(s=l[t-1].close,A+=f(h-s),u+=f(s-o),0===u?n.br=0:n.br=A/u*100,t>=r[0]-1&&(o=l[t-(r[0]-1)],M-=o.high-o.open,c-=o.open-o.low,t>r[0]-1&&(t=l[t-(r[t=0]-1)-1].close,A-=f(o.high-t),u-=f(t-o.low)))),i.push({AR:n.ar||0,BR:n.br||0})}),i}function CR(o,e=[26,6,10,20,60]){let h=[],l=[0,0,0,0];const r=[],M=[];let c=0,A=0,u=[],i=[];const s=[],f={CR:0,MA1:0,MA2:0,MA3:0,MA4:0};let E;return o.forEach((o,t)=>{0===t&&(E=o);var n=(E.high+E.low)/2,t=Math.max(0,o.high-n);u.push(t),c+=t;n=Math.max(0,n-o.low);i.push(n),A+=n,0!==A&&(f.CR=c/A*100),u.length===e[0]&&(c-=u.shift()),i.length===e[0]&&(A-=i.shift()),e.slice(1).forEach((o,t)=>{h[t]=h[t]||0,h[t]+=f.CR,r[t]=r[t]||[],r[t].push(f.CR);var n=Math.floor(o/2.5+1);r[t].length===o&&(M[t]=M[t]||[],M[t].push(h[t]/o),l[t]++,h[t]-=r[t].shift()),l[t]>=n&&(n=l[t]-n-1,f[`MA${t+1}`]=M[t][n]||0)}),E=o,s.push({...f})}),s}function DMA(l,r=[10,50,10]){const M=Math.max(r[0],r[1]);let c=0,A=0,u=0;const i=[];return l.forEach((o,t)=>{const n={DMA:0,AMA:0};o=o.close;c+=o,A+=o;let e,h;t>=r[0]-1&&(e=c/r[0],c-=l[t-(r[0]-1)].close),t>=r[1]-1&&(h=A/r[1],A-=l[t-(r[1]-1)].close),t>=M-1&&(o=e-h,n.DMA=o,u+=o,t>=M+r[2]-2&&(n.AMA=u/r[2],u-=i[t-(r[2]-1)].DMA)),i.push({...n})}),i}function EMV(h,l=[14,9]){let r=0,M=0,c=0,A=0,u,i,s,f,E;const a=[],R=[],g={EMV:0,EMVA:0};return h.forEach((o,t)=>{var n=o.high,e=o.low;c+=n-e,A+=o.volume,t>=l[0]-1&&E&&(u=0===o.volume?0:A/l[0]/o.volume,i=(n+e-(E.high+E.low))/(n+e)*100,s=0===c?0:i*u*(n-e)/(c/l[0]),a.push(s),r+=s,f=h[t-(l[0]-1)],A-=f.volume,c-=f.high-f.low,t>=2*l[0]-2&&(g.EMV=r/l[0],r-=a.shift(),M+=g.EMV,t>=2*l[0]+l[1]-3&&(g.EMVA=M/l[1],M-=R[t-(l[1]-1)].EMV))),E=o,R.push({...g})}),R}function KDJ(o,t=[9,3,3]){var n,e=t[0],h=t[1],l=t[2];let r=1/0,M=-1/0,c,A=0,u=0,i,s,f=[];for(i=0;i<o.length;i++){for(n=o[i].close,r=1/0,M=-1/0,s=i<e?0:i-e+1;s<=i;s++)r>o[s].low&&(r=o[s].low),M<o[s].high&&(M=o[s].high);c=(n-r)/(M-r)*100,!isNaN(c)&&c!==-1/0&&c!==1/0||(c=0),u=i<e?(A=(c+A*i)/(i+1),(A+u*i)/(i+1)):(A=(c+(h-1)*A)/h,(A+(l-1)*u)/l),n=3*A-2*u,f.push({K:A,D:u,J:n})}return f}function MACD(o,n=[12,26,9]){let e,h,l=0,r=0,M,c=0,A;const u=[];return o.forEach((o,t)=>{o=o.close;h=0===t?e=o:(e=(2*o+(n[0]-1)*l)/(n[0]+1),(2*o+(n[1]-1)*r)/(n[1]+1));o=e-h;M=(2*o+c*(n[2]-1))/(n[2]+1),A=2*(o-M),l=e,r=h,c=M,u.push({DIFF:o,DEA:M,MACD:A})}),u}function MAVOL(l,t=[1,5,10,20]){const n=[];return l.forEach((o,e)=>{const h={};t.forEach(t=>{let n=0;if(t-1<=e)for(let o=t;0<o;o--)n+=l[e-o+1].volume;h["VOL"+t]=n/(1e4*t)}),n.push({...h})}),n}function RSI(o,t=[6,12,24]){let n=t[0],e=t[1],h=t[2],l,r,M,c,A,u,i,s,f,E,a,R,g=[];for(R=0;R<o.length;R++)l=o[R].close,0==R?(r=l,c=i=E=0,A=s=a=0):(r=o[R-1].close,c=SMA(MAX(l-r,0),n,1,c),A=SMA(ABS(l-r),n,1,A),i=SMA(MAX(l-r,0),e,1,i),s=SMA(ABS(l-r),e,1,s),E=SMA(MAX(l-r,0),h,1,E),a=SMA(ABS(l-r),h,1,a)),M=c/A*100||0,u=i/s*100||0,f=E/a*100||0,g.push({["RSI"+n]:M,["RSI"+e]:u,["RSI"+h]:f});return g}function WR(r,t,M){return void 0===M&&(M=[{key:"WR1",title:"WR1",type:"line"},{key:"WR2",title:"WR2",type:"line"}]),r.map(function(o,e){var h={WR1:0,WR2:0},l=o.close;return t.forEach(function(o,t){var n=o-1;n<=e&&(o=(n=(o=calcHnLn(r.slice(e-n,e+1))).hn)-o.ln,h[M[t].key]=0==o?0:(n-l)/o*100)}),h})}export{ARBR,BOLL,CR,DMA,EMA,EMV,KDJ,MA,MACD,MAVOL,RSI,SAR,WR};
